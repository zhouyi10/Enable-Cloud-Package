<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.enableets.edu.pakage.framework.ppr.test.dao.PackageUserAnswerInfoDAO">

	<select id="queryUserMarkQuestion" parameterType="java.lang.String" resultType="com.enableets.edu.pakage.framework.ppr.test.po.UserAnswerInfoPO">
		SELECT
			t1.user_id AS userId,
			t1.parent_id AS questionId,
			if (SUM(t1.mark_status) = COUNT(1), '1', '0') AS markStatus
		FROM
			t_as_user_answer t1,
			(
				SELECT
					max(test_user_id) AS test_user_id
				FROM
					t_as_test_user
				WHERE
					test_id = #{testId}
				GROUP BY
					user_id
			) t2
		WHERE t1.test_user_id = t2.test_user_id GROUP BY t1.user_id, t1.parent_id

	</select>
</mapper>
